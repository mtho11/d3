<!DOCTYPE html>
<html>
<head>
    <title>RHQ d3 Chart Tester</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style>
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .x.axis path {
            /* display: none;*/
        }
    </style>
</head>
<body>
<span>Chart Tester</span>

<div>
    <div id="rChart-myChart">
        <svg></svg>
    </div>
</div>

<script type="text/javascript">

var chartId = "myChart",
        chartHandle = "#rChart-" + chartId,
        chartSelection = chartHandle + " svg",
        yAxisLabel = "ms",
        yAxisUnits = "ms",
        xAxisLabel = "Time";

var json = eval([
    { x:1352204720548, high:5.016642348035599646, low:3.016642348035599646, y:4.016642348035599646},
    { x:1352211680548, high:8.000200003333388, low:4.0, y:5.500050000833347},
    { x:1352211920548, high:2.000033333888898, low:1.999966667222213, y:2.000000000277778},
    { x:1352212160548, high:5.0, low:1.999966667222213, y:2.750000000277778},
    { x:1352212400548, high:4.0, low:2.0, y:2.5000083334722243},
    { x:1352212640548, high:2.0, low:1.999966667222213, y:1.9999916668055533},
    { x:1352212880548, high:3.0, low:2.0, y:2.2500083334722243},
    { x:1352213120548, high:3.000050000833347, low:2.999966667222213, y:2.2500041672916677},
    { x:1352213360548, high:6.0, low:1.999966667222213, y:5.0499916668055535},
    { x:1352213600548, high:7.000033333888898, low:3.999966667222213, y:4.000008333750002},
    { x:1352213840548, high:2.0, low:1.999966667222213, y:1.9999916668055533},
    { x:1352214080548, high:3.0, low:1.999966667222213, y:2.250000000277778},
    { x:1352214320548, high:4.0, low:2.0, y:2.5},
    { x:1352214560548, high:3.0, low:1.999966667222213, y:2.250000000833347},
    { x:1352214800548, high:2.000033333888898, low:1.999966667222213, y:2.000000000277778},
    { x:1352215040548, high:4.0, low:2.0, y:2.5},
    { x:1352215280548, high:3.0, low:2.0, y:2.2500083334722243},
    { x:1352215520548, high:2.0, low:1.999966667222213, y:1.9999916668055533},
    { x:1352215760548, high:3.0, low:1.999966667222213, y:2.250000000277778},
    { x:1352216000548, high:4.0, low:2.0, y:2.5},
    { x:1352216240548, high:2.000066668888963, low:1.999966667222213, y:2.000008334027794},
    { x:1352216480548, high:3.0, low:1.999966667222213, y:2.2499916668055535}
]);
var json2 = eval(
        [
            { x:1353860526384, high:1.0000333344444814, low:0.005050312475458637, y:0.9751266746243866},
            { x:1353865926384, high:160.0268171136186, low:0.9999833336111065, y:21.144743338839582},
            { x:1353871326384, high:149.0, low:0.0, y:5.189418869590717},
            { x:1353876726384, high:5.000083334722245, low:1.999966667222213, y:2.466857373201945},
            { x:1353882126384, high:4.9999166680555325, low:1.999866675554963, y:2.411110741376545},
            { x:1353887526384, high:5.0, low:1.999966667222213, y:2.4111100003456785},
            { x:1353892926384, high:4.0, low:0.9997334044254865, y:1.1625006269826392},
            { x:1353898326384, high:24.0, low:0.0, y:5.962227999053264},
            { x:1353936126384, high:1.000016666944449, low:0.004979783737951828, y:0.9423038932853648},
            { x:1353941526384, high:40.99323344610923, low:0.0, y:6.099925557049361},
            { x:1353946926384, high:5.000083334722245, low:2.9999000033332224, y:3.1555537043456754},
            { x:1353952326384, high:5.000166672222407, low:2.9999500008333193, y:3.166669048134926},
            { x:1353963126384, high:21.00035000583343, low:0.0, y:3.1876754880905587},
            { x:1353968526384, high:5.0, low:1.9999333355554816, y:2.1555535190277726},
            { x:1353973926384, high:5.000083334722245, low:1.9999333355554816, y:2.1666675930154318},
            { x:1353979326384, high:4.9999166680555325, low:1.999966667222213, y:2.15384551318376},
            { x:1354022526384, high:5.0, low:0.03840652954895509, y:3.101282440633114},
            { x:1354027926384, high:5.000083334722245, low:2.9999000033332224, y:3.1444422227654285},
            { x:1354033326384, high:30.0, low:0.9999666677777408, y:1.5280897005649188},
            { x:1354038726384, high:1.0000333344444814, low:0.9999833336111065, y:1.0000001853179015},
            { x:1354044126384, high:1.0000333344444814, low:0.9999666677777408, y:0.9999998149907401},
            { x:1354049526384, high:1.0000333344444814, low:0.0, y:0.9888890742129631},
            { x:1354054926384, high:1.0000333344444814, low:0.9999833336111065, y:1.000000000160495},
            { x:1354060326384, high:1.0000333344444814, low:0.9999833336111065, y:1.000000000135803},
            { x:1354065726384, high:1.0000333344444814, low:0.9999666677777408, y:1.0000000001872669},
            { x:1354071126384, high:1.0000333344444814, low:0.07256039846945933, y:0.9784316373545864},
            { x:1354092726384, high:0.005526877458395394, low:0.005526877458395394, y:0.005526877458395394},
            { x:1354108926384, high:1.000016666944449, low:0.008148809207719801, y:0.9680053381196023},
            { x:1354114326384, high:1.0000333344444814, low:0.9999666677777408, y:0.9999998149845675},
            { x:1354119726384, high:1459.0243170719511, low:0.9999666677777408, y:20.83360259738896},
            { x:1354125126384, high:83.0, low:0.9999666677777408, y:4.2777905561080285},
            { x:1354130526384, high:5.000166672222407, low:2.9999000033332224, y:3.1555553709413573},
            { x:1354135926384, high:5.0, low:2.9999000033332224, y:3.1666659264197516},
            { x:1354141326384, high:6.924568368571692, low:1.5650268662945381, y:3.194329206807157},
            { x:1354146726384, high:5.000166672222407, low:2.9999000033332224, y:3.2000016673981477},
            { x:1354152126384, high:12.0, low:0.9999833336111065, y:3.224718727228463}
        ]
);

function draw(data) {
    "use strict";

    var margin = {top:10, right:5, bottom:30, left:70},
            width = 500 - margin.left - margin.right,
            height = 150 - margin.top - margin.bottom;

    var avg = d3.mean(data.map(function (d) {
        return d.y;
    }));
    var peak = d3.max(data.map(function (d) {
        return d.high;
    }));
    var min = d3.min(data.map(function (d) {
        return d.low;
    }));


    var dateFormat = d3.time.format("%I %p");


    var timeScale = d3.time.scale()
            .range([0, width])
            .domain(d3.extent(data, function (d) {
        return d.x;
    }));
    // timeScale.ticks(d3.time.hours, 1);

    var yScale = d3.scale.linear()
            .rangeRound([height, 0])
            .domain([d3.min(data.map(function (x) {
        return x.low;
    })), d3.max(data.map(function (x) {
        return x.high;
    }))]);

    var xAxis = d3.svg.axis()
            .scale(timeScale)
            .ticks(5)
            .orient("bottom");

    var yAxis = d3.svg.axis()
            .scale(yScale)
            .ticks(5)
            .orient("left");

    var interpolation = "basis";
    //var interpolation = "step-before";
    var avgLine = d3.svg.line()
            .interpolate(interpolation)
            .x(function (d) {
                return timeScale(d.x);
            })
            .y(function (d) {
                return yScale((avg));
            });
    var peakLine = d3.svg.line()
            .interpolate(interpolation)
            .x(function (d) {
                return timeScale(d.x);
            })
            .y(function (d) {
                return yScale((peak));
            });
    var line = d3.svg.line()
            .interpolate(interpolation)
            .x(function (d) {
                return timeScale(d.x);
            })
            .y(function (d, i) {
                return yScale((+d.y));
            });

    var highLine = d3.svg.line()
            .interpolate(interpolation)
            .x(function (d) {
                return timeScale(d.x);
            })
            .y(function (d) {
                return yScale(+d.high);
            });

    var lowLine = d3.svg.line()
            .interpolate(interpolation)
            .x(function (d) {
                return timeScale(d.x);
            })
            .y(function (d) {
                return yScale(+d.low);
            });


    // create the actual chart group
    var svg = d3.select(chartSelection).append("g")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // create x-axis
    svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);


    // create y-axis
    svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -60)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text(yAxisUnits === "NONE" ? "" : yAxisUnits);

    console.log("finished axes");


    // The bars of the bar graph
    svg.selectAll("rect")
            .data(data)
            .enter().append("rect")
            .attr("x", function (d) {
                return timeScale(d.x);
            })
            .attr("y", function (d) {
                return yScale(d.y);
            })
            .attr("height", function (d) {
                return height - yScale(d.y);
            })
            .attr("width", function (d) {
                return  (width / data.length - 5 );
            })
            .attr("data-rhq-value", function (d) {
                return d.y;
            })
            .attr("data-rhq-time", function (d) {
                var myDate = new Date(d.x);
                return myDate.getHours() + ":" + myDate.getMinutes();
            })
            .attr("opacity", 0.5)
            .attr("fill", "red");

    var radius = 2;
    var edgeToCenter = 3;

    // the high whisker
    svg.selectAll("circle.marker")
            .data(data)
            .enter().append("circle")
            .attr("class", "marker")
            .attr("cx", function (d) {
                return  timeScale(d.x) + (2 * edgeToCenter);
            })
            .attr("cy", function (d) {
                return yScale(d.y);
            })
            .attr("r", radius)
            .attr("fill", "none")
            .attr("stroke", "black")
            .attr("stroke-width", "2");

    // peak Line (must be before line.high to look right
    svg.append("path")
            .datum(data)
            .attr("class", "peakLine")
            .attr("fill", "none")
            .attr("stroke", "red")
            .attr("stroke-width", "2")
            .attr("stroke-dasharray", "5,5")
        //.attr("stroke-dasharray", "20,10,5,5,5,10")
            .attr("stroke-opacity", ".6")
            .attr("d", peakLine);

    svg.selectAll("line.highWhisker")
            .data(data)
            .enter().append("line")
            .attr("class", "highWhisker")
            .attr("x1", function (d) {
                return timeScale(d.x);
            })
            .attr("x2", function (d) {
                return timeScale(d.x) + ( 4 * edgeToCenter);
            })
            .attr("y1", function (d) {
                return yScale(d.high);
            })
            .attr("y2", function (d) {
                return yScale(d.high);
            })
            .attr("stroke-width", "1")
            .attr("stroke-opacity", ".4")
            .attr("stroke", "black");

    svg.selectAll("line.lowWhisker")
            .data(data)
            .enter().append("line")
            .attr("class", "lowWhisker")
            .attr("x1", function (d) {
                return timeScale(d.x);
            })
            .attr("x2", function (d) {
                return timeScale(d.x) + ( 4 * edgeToCenter);
            })
            .attr("y1", function (d) {
                return yScale(d.low);
            })
            .attr("y2", function (d) {
                return yScale(d.low);
            })
            .attr("stroke-width", "1")
            .attr("stroke-opacity", ".4")
            .attr("stroke", "black");


    // Whisker stem
    svg.selectAll("line.stem")
            .data(data)
            .enter().append("line")
            .attr("class", "stem")
            .attr("x1", function (d) {
                return timeScale(d.x) + (2 * edgeToCenter);
            })
            .attr("x2", function (d) {
                return timeScale(d.x) + (2 * edgeToCenter);
            })
            .attr("y1", function (d) {
                return yScale(d.high);
            })
            .attr("y2", function (d) {
                return yScale(d.low);
            })
            .attr("stroke-width", "1.5")
            .attr("stroke-opacity", ".6")
            .attr("stroke-dasharray", "2,2")
            .attr("stroke", "black");


    svg.append("path")
            .datum(data)
            .attr("class", "avgLine")
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", "2")
            .attr("stroke-dasharray", "5,5")
            .attr("stroke-opacity", ".6")
            .attr("d", avgLine);


    console.log("finished drawing paths");
}
draw(json);

</script>
</body>
</html>
